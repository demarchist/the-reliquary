---
import BaseLayout from '../../layouts/BaseLayout.astro';
import WikiCard from '../../components/WikiCard.astro';
import { getCollection } from 'astro:content';

const allEntries = await getCollection('wiki');

const categories = ['People', 'Places', 'Things', 'Factions', 'Events'] as const;

const grouped = new Map<string, typeof allEntries>();
for (const cat of categories) {
  grouped.set(cat, allEntries.filter(e => e.data.category === cat).sort((a, b) => a.data.title.localeCompare(b.data.title)));
}
---

<BaseLayout title="Wiki">
  <h1 class="font-serif text-3xl font-bold text-ink-900 mb-2">Wiki</h1>
  <p class="text-ink-400 mb-8">People, places, factions, items, and events of <em>The Rise of Atropos</em>.</p>

  {allEntries.length === 0 ? (
    <div class="text-center py-12 text-ink-400">
      <p>No wiki entries yet. Entity extraction will be performed in a future phase.</p>
    </div>
  ) : (
    <div class="space-y-10">
      {categories.map(category => {
        const entries = grouped.get(category) || [];
        if (entries.length === 0) return null;
        return (
          <section>
            <h2 class="font-serif text-xl font-semibold text-ink-800 mb-4">{category}</h2>
            <div class="grid sm:grid-cols-2 gap-3">
              {entries.map(entry => (
                <WikiCard
                  title={entry.data.title}
                  category={entry.data.category}
                  description={entry.data.description}
                  slug={entry.id}
                />
              ))}
            </div>
          </section>
        );
      })}
    </div>
  )}
</BaseLayout>
